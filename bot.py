from telegram.ext import ApplicationBuilder, ContextTypes
import asyncio
import requests

BOT_TOKEN = "7592713558:AAHKKvq5tSgGz20xl5bDxCDyAz6kz5_jhAg"
CHAT_ID = "7723036384"

IVASMS_NUMBERS = [
    "2250141845964", "2250141841540", "2250141846218", "2250141841791",
    "2250141842717", "2250141847338", "2250141843265", "2250141844415",
    "2250141849924", "2250141840358", "2250141849010", "2250141842112",
    "2250141845873", "2250141846320", "2250141846178", "2250141845876",
    "2250141847422", "2250141848184", "2250141842832", "2250141840757",
    "2250141847176", "2250141849402", "2250141841835", "2250141844623",
    "2250141846648", "2250141845499", "2250141840020", "2250141848694",
    "2250141840933", "2250141843511", "2250141845825", "2250141843203",
    "2250141845326", "2250141841750", "2250141846364", "2250141842959",
    "2250141846037", "2250141845009", "2250141848183", "2250141846087",
    "2250141848224", "2250141844926", "2250141845801", "2250141840506",
    "2250141845345", "2250141843635", "2250141849673", "2250141842126",
    "2250141846174", "2250141842439", "2250141842896", "2250141846864",
    "2250141843439", "2250141849378", "2250141848014", "2250141841729",
    "2250141842267", "2250141841856", "2250141846060", "2250141846517",
    "2250141848961", "2250141843682", "2250141843802", "2250141848906",
    "2250141848122", "2250141841165", "2250141848592", "2250141840106",
    "2250141845266", "2250141847294", "2250141843625", "2250141844646",
    "2250141844410", "2250141847611", "2250141844954", "2250141842948",
    "2250141843953", "2250141840205", "2250141847511", "2250141847086",
    "2250141847860", "2250141849741", "2250141840871", "2250141842123",
    "2250141849712", "2250141848347", "2250141845071", "2250141845845",
    "2250141847445", "2250141840472", "2250141842826", "2250141846312",
    "2250141842274", "2250141844820", "2250141845114", "2250141841509",
    "2250141849313", "2250141844267", "2250141845469", "2250141847862"
]

latest_messages = {}

async def fetch_and_send(context: ContextTypes.DEFAULT_TYPE):
    bot = context.bot
    global latest_messages

    for number in IVASMS_NUMBERS:
        try:
            url = f"https://ivasms.com/api/messages?number={number}"
            response = requests.get(url)
            data = response.json()

            if data and isinstance(data, list):
                msg = data[0]["message"]
                if number not in latest_messages or latest_messages[number] != msg:
                    latest_messages[number] = msg
                    await bot.send_message(chat_id=CHAT_ID, text=f"ðŸ“© {number} âžœ {msg}")
        except Exception as e:
            print(f"{number} âžœ error: {e}")

async def main():
    app = ApplicationBuilder().token(BOT_TOKEN).build()
    app.job_queue.run_repeating(fetch_and_send, interval=60)
    print("Bot is running...")
    await app.run_polling()

if __name__ == "__main__":
    asyncio.run(main())
